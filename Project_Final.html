<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dream Experience Analysis Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Project_Final_files/libs/clipboard/clipboard.min.js"></script>
<script src="Project_Final_files/libs/quarto-html/quarto.js"></script>
<script src="Project_Final_files/libs/quarto-html/popper.min.js"></script>
<script src="Project_Final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Project_Final_files/libs/quarto-html/anchor.min.js"></script>
<link href="Project_Final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Project_Final_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Project_Final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Project_Final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Project_Final_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dream Experience Analysis Project</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="zac-cross" class="level3">
<h3 class="anchored" data-anchor-id="zac-cross">Zac Cross</h3>
</section>
<section id="term-project-for-cs670" class="level3">
<h3 class="anchored" data-anchor-id="term-project-for-cs670">Term Project for CS670</h3>
</section>
<section id="march-2025" class="level3">
<h3 class="anchored" data-anchor-id="march-2025">21 March 2025</h3>
<hr>
</section>
<section id="section-0-project-overview" class="level1">
<h1>Section 0: Project Overview</h1>
<p>The following notebook contains work for our dream experience analysis project for CS670 term project at the UO. Data was taken from the aggregate study of Wong et al.&nbsp;penned the Dream EEG and Mentation (DREAM) database.</p>
<p>We think that this topic is worth exploring because Dreaming is a very human experience that we all share. To date, it remains an unexplored topic for serious scientific analysis at scale. We hope that the following project shows the potential to use datascience techniques with dreams and related data to find patterns and relationships in our dreaming.</p>
<section id="project-format" class="level2">
<h2 class="anchored" data-anchor-id="project-format">Project Format</h2>
<section id="section-1---data" class="level3">
<h3 class="anchored" data-anchor-id="section-1---data">Section 1 - Data:</h3>
<ul>
<li>We introduce the data, its format and raw state as well as the motivations of its authors and gathers.</li>
<li>We explain and justify methods for cleaning the data</li>
<li>We include exploratory visualizations with slices and plots.</li>
</ul>
</section>
<section id="section-2---research-questions" class="level3">
<h3 class="anchored" data-anchor-id="section-2---research-questions">Section 2 - Research Questions:</h3>
<ul>
<li>We list the questions and problems we investigate in this project.</li>
<li>We include explanation of why these questions are interesting and relevant.</li>
</ul>
</section>
<section id="section-3---models-and-visualizations" class="level3">
<h3 class="anchored" data-anchor-id="section-3---models-and-visualizations">Section 3 - Models and Visualizations:</h3>
<ul>
<li>We introduce the relevant models and tests we use to approach our questions.</li>
<li>We show relevant visualizations that help us answer our questions.</li>
<li>We provide interpretation of our model results and visualizations.</li>
</ul>
</section>
<section id="section-4---results-analysis-and-discussion" class="level3">
<h3 class="anchored" data-anchor-id="section-4---results-analysis-and-discussion">Section 4 - Results, Analysis, and Discussion:</h3>
<ul>
<li>We summarize our questions, the evidence of our models, visuals, and test.</li>
<li>We explain the limitations and biases of our approach</li>
<li>We propose future directions for work to improve our models and understanding</li>
</ul>
</section>
<section id="section-5---impact" class="level3">
<h3 class="anchored" data-anchor-id="section-5---impact">Section 5 - Impact:</h3>
<ul>
<li>We conclude the report with our thoughts on the short, medium, and long term impacts of a project like this.</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="section-1-big-dream-data" class="level1">
<h1>Section 1: Big Dream Data</h1>
<section id="background-on-the-dream-dataset" class="level2">
<h2 class="anchored" data-anchor-id="background-on-the-dream-dataset">1.1 Background on the DREAM Dataset</h2>
<section id="who-collected-it-and-what-is-in-it" class="level3">
<h3 class="anchored" data-anchor-id="who-collected-it-and-what-is-in-it">1.1.1 Who Collected it and What is in it?</h3>
<p>The DREAM dataset was created by Wong et al.&nbsp;at Monash University in Australia as a publicly available dream data repository for the global psychology and neuroscience research communities. They define dream data as Magneto/electroencephalography (M/EEG) readings to measure brain waves combined with dream experience reports. They define a dream experience as recollected thoughts, feelings, and experiences during sleep that can recited back to either a human researcher or an audio recorder. It is important to note that their definition of dream experience or more broad than the typically thought of dream experience where one is conscious in a dream reality. They include any form of thoughts or feelings, including day dream like experiences, that come from NREM and REM alike.</p>
<p>Columns included in every report include:</p>
<ul>
<li><p>Identifiers: Filename, Case ID, Subject ID, and Treatment Group</p></li>
<li><p>M/EEG Related Data: Duration of recording in seconds, Has EMG, Has ECG, EEG sample rate, Number of EEG channels</p></li>
<li><p>Last Sleep Stage before Awakening Category: Last sleep stage in categories 0 - Awake, 1 - 4 being NREM stages 1 - 4, and 5 - REM.</p></li>
<li><p>Time of Awakening in local time.</p></li>
<li><p>Subject Physical Attributes: Assigned Sex, Age, is Healthy (indicating if a sleep disorder is not present)</p></li>
<li><p>Dream Experience Categories: -2, -4 - Mixed categorization, 0 - No Dream, 1 - Dream but no Recall, 2 - Dream with Recall.</p></li>
</ul>
<p>The point of DREAM is to provide a standard format for researchers in the space to collect data in, so different experiments can be compared to more gereal data. Currently, the DREAM dataset consists of 2649 awakening datapoints from 561 participants across 20 different studies around the globe. For the most part, studies include all columns of data in the report, but some do miss age, sex, or other inputs. As part of the standard, the M/EEG data, each entry has at least 20 seconds of continuos M/EEG data before awakening from at least 2 electrodes, and a sampling rate of at least 100Hz. as well as their specific protocol for collecting the report and the raw text if available. Data is collected on willing participants who sleep with M/EEG monitoring electrodes attatched and dream experiences are recorded with audio. Some studies choose to have a structured series of questions about a dream experience, while other simply record the unstructured speech to text.</p>
<p>This representation choice is meant to give researchers some flexibility in how to record M/EEG data and patient characteristics and experience, while ensuring the most useful and basic information is kept uniform in the Report.csv. However, it does miss much of the dream experience that could be helpful in answering questions, like how much total sleep, how many full sleep cycles, participant sentiment going to sleep, … etc. This is a generalized but limited dataset.</p>
</section>
<section id="why-was-it-collected-and-aggregated" class="level3">
<h3 class="anchored" data-anchor-id="why-was-it-collected-and-aggregated">1.1.2 Why Was it Collected and Aggregated?</h3>
<p>At a high level the neuroscience and psychology research communities are interested in correlating different stages of sleep, from the 3 non-Rapid Eye Movement (NREM) stages to REM, with different recorded dream experiences. Researchers want this data to investigate a variety of research topic including: dreaming and clinical sleep disorders, dreaming and neurocognitive functions like memory, and basic correlations of brain activity and reported dream experiences (i.e.&nbsp;how do the different stages of sleep correlate with dream experiences?).</p>
<p>The DREAM dataset comes as a solution to the largest problem in the field of Dream and other neuroscience research of small sample sizes for experiments. Typically, study sizes range from 10s - 100s of participants with a handful of sleep and awakening data due to cost and the effort of data collection. As a result, many studies make general claims that do not generalize well across many populations of sleepers globally. Additionally, data collection and reporting methods vary across research groups making it tough, if not impossible, to use other groups’ data to test and confirm other hypotheses. As a result, Wong, et al.&nbsp;proposed the DREAM dataset as a standardized recording and reporting method for DREAM data.</p>
</section>
</section>
<section id="working-with-the-dream-dataset" class="level2">
<h2 class="anchored" data-anchor-id="working-with-the-dream-dataset">1.2 Working with the DREAM Dataset</h2>
<p>We set out on this project mainly interested in the raw text narrations of dream experiences. We wanted to do some exploratory analysis with dream themes and sentiment and see what kinds of interesting patterns or phenemena could be teased out the dataset. However, we quickly found that working with the data present in the DREAM dataset was not as easy as expected. We now go through experiences working with the data, some of the decisions we made for cleaning, and how that process influenced the questions we chose to explore.</p>
<section id="getting-and-understanding-the-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-and-understanding-the-data">1.2.1 Getting and Understanding the Data</h3>
<p>The DREAM Dataset is publicly available at this <a href="https://bridges.monash.edu/projects/The_Dream_EEG_and_Mentation_DREAM_database/158987">link</a> hosted by Monash University. It includes just an Excel spreadsheet with the relevant formatting of datasets and the location of each individual study’s data. From there we attempted to download each dataset, but quickly ran into issues. In most cases, the M/EEG data bulked up the filesize to over 10GB, with no way to selective include or exclude that data. And of the 20 studies, only 10 ended up being undamaged and usable after decompression, <strong>reducing the usable data from 2649 to 1933 awakenings.</strong> The main data from each study was kept in standardized Reports.csv file that kept the relevant information mentioned in 1.1. The unusability of 1/4 of the data was surprsing, but was important lesson to look at more than a single dataset before jumping into a project.</p>
<p>Continuuing the trend of unusability, only 3 of the remaining 10 studies had actual speech to text transcriptions of the dream narratives. These 3 studies were labeled Zhang, LODE, and Oudiette. 1 more study had a recorded dialogue between participants and researchers about the sleep exprience, but after review we found that the dialogues weren’t useful in picking out actual dreams. They were a 2 person Q/A between the participant and the researcher and would have taken more transformation to try and pull out themes. Moreover, there was more heterogeneity than expected even among the three promising studies. Each study had different dream recording and reporting formats and were in different languages. The Zhang study was in english with all dream raw text in a single spreadsheet, which was easy to copy and use. The LODE and Oudiette studies were in Italian and French respectively and recorded each dream text in a separate text file that had to be translated and copied over manually.</p>
</section>
<section id="data-cleaning-and-decisions" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning-and-decisions">1.2.2 Data Cleaning and Decisions</h3>
<p>We chose to break the data into 2 overlapping groups. The first is a larger dataset aggregating the Report.csv from all 10 studies into 1 excel spreadsheet we dub “Global Data” from here on.</p>
<p>It includes the following attributes:</p>
<ul>
<li><p>Identifiers: Filename, Case ID, Subject ID, and Study</p></li>
<li><p>M/EEG Related Data: Duration of recording in seconds, Has EMG, Has ECG, EEG sample rate, Number of EEG channels</p></li>
<li><p>Last Sleep Stage before Awakening Category: Last sleep stage in categories 0 - Awake, 1 - 4 being NREM stages 1 - 4, and 5 - REM.</p></li>
<li><p>Time of Awakening in local time.</p></li>
<li><p>Subject Physical Attributes: Assigned Sex, Age, is Healthy (indicating if a sleep disorder is not present)</p></li>
<li><p>Dream Experience Categories: -2, -4 - Mixed categorization, 0 - No Dream, 1 - Dream but no Recall, 2 - Dream with Recall.</p></li>
</ul>
<p>We chose to omit several datafields including the dream text fields, and other less interesting information like treatment group since it was rarely filled in in the original data. We add a column for the name of the study for later study to study comparisons. The goal and use for this slice of the data is to look at comparisons between groups for different physical attributes like sex, age, and time of awakening. We use this in Questions 1 and 2, where we try to predict if a participant has a dream experience.</p>
<p>Next, we do transformations and cleaning to get a 2nd slice of the data focused on the dream text. We dub this slice “Dream Data” from here on.</p>
<p>First, we merge all of the dream text reports from the 3 studies Zhang, LODE, and Oudiette. and translate to english using google translate and batching by language. At this point we had 741 raw dream texts in English. Next, we read through the english text and marked the dream texts with no interesting dream content. This was a subjective decision, made by looking for text that amounted to “I do not remember my dream”. This does influence the final results of this project, as some of our categorizations do not align with the experience category of the authors.</p>
<p>We then wanted extract the themes and sentiment of each dream using ChatGPT with the following prompt:</p>
<p><strong>Please take the following dream text and provide a 3 word summary of the theme and a 2 word summary of the sentiment, ignoring confusion or uncertainty:{Dream Text}</strong></p>
<p>We ask for 3 word and 2 word summaries of the theme and sentiments to give the LLM a constraint to make the output somewhat predicatable, but also give it some room to give expressive answers. We think that having some room for expression would be interesting for a comparison of different LLM models in a future project. Each entry was done with a fresh chat, as to reduce the influence of the LLM using previous dreams as context for the next. Each theme and sentiment was extracted only once.</p>
<p>Finally, we pull out the word count for each dream in it’s native language and in english for some more quantitative predictors for possible use in prediction tasks.</p>
</section>
<section id="code-for-data-cleaning-and-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="code-for-data-cleaning-and-manipulation">1.2.3 Code for Data Cleaning and Manipulation</h3>
<p>The below cells use Python to take the raw aggregated data above and produce 2 slices of cleaned data. All is done using Pandas Dataframes and saving data in .xlsx spreadsheets.</p>
<div id="4aa19d50" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Cleaning + Feature Extraction</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pwd = os.getcwd()</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(pwd)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># FS Setup</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>pwd <span class="op">=</span> <span class="st">"~/Desktop/CS670_Data_Science/Project_Materials"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> pwd <span class="op">+</span> <span class="st">"/Data/"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the whole dataset</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="st">"All_records.xlsx"</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>unclean_df <span class="op">=</span> pd.read_excel(data_path<span class="op">+</span><span class="bu">file</span>, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Dream Data File Path</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>new_file <span class="op">=</span> data_path <span class="op">+</span> <span class="st">"Dream_Records.xlsx"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filter out a few things</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 1: Isolate Dreams</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>dream_mask <span class="op">=</span> unclean_df[<span class="st">"Real Dream Narrative"</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>dream_data <span class="op">=</span> unclean_df[dream_mask].copy() <span class="co"># thank you python lol</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1: Feature Extraction</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab some useful things out of the narratives</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>theme_1 <span class="op">=</span> []</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>theme_2 <span class="op">=</span> []</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>theme_3 <span class="op">=</span> []</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>sent_1 <span class="op">=</span> []</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>sent_2 <span class="op">=</span> []</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Start parsing</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st, themes</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> theme <span class="kw">in</span> dream_data[<span class="st">"ChatGPT Theme"</span>]:</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    themes <span class="op">=</span> theme.split(<span class="st">","</span>) <span class="co"># split on indv themes</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    num_themes <span class="op">=</span> <span class="bu">len</span>(themes)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> num_themes <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> themes[<span class="dv">0</span>]</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        t2 <span class="op">=</span> <span class="st">'NA'</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        t3 <span class="op">=</span> <span class="st">'NA'</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> num_themes <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> themes[<span class="dv">0</span>]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        t2 <span class="op">=</span> themes[<span class="dv">1</span>]</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        t3 <span class="op">=</span> <span class="st">'NA'</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> num_themes <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> themes[<span class="dv">0</span>]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        t2 <span class="op">=</span> themes[<span class="dv">1</span>]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        t3 <span class="op">=</span> themes[<span class="dv">2</span>]</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Parsing Issue in Themes"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>()</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    theme_1.append(t1)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    theme_2.append(t2)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    theme_3.append(t3)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Next Sentiment</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sent <span class="kw">in</span> dream_data[<span class="st">"ChatGPT Sentiment"</span>]:</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    sents <span class="op">=</span> sent.split(<span class="st">","</span>) <span class="co"># split on indv themes</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    num_sents <span class="op">=</span> <span class="bu">len</span>(sents)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> num_sents <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        s1 <span class="op">=</span> sents[<span class="dv">0</span>]</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        s2 <span class="op">=</span> <span class="st">'NA'</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> num_sents <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        s1 <span class="op">=</span> sents[<span class="dv">0</span>]</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        s2 <span class="op">=</span> sents[<span class="dv">1</span>]</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Parsing Issue in Sentiments </span><span class="sc">{</span>sents<span class="sc">}</span><span class="ss">, with len </span><span class="sc">{</span>num_sents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>()</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    sent_1.append(s1)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    sent_2.append(s2)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="co"># English Dream word count</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Native Language Word Count</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>english_word_count <span class="op">=</span> [<span class="bu">len</span>(x.split()) <span class="cf">for</span> x <span class="kw">in</span> dream_data[<span class="st">"Translation"</span>]]</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>native_word_count <span class="op">=</span> [<span class="bu">len</span>(x.split()) <span class="cf">for</span> x <span class="kw">in</span> dream_data[<span class="st">"Text of Report"</span>]]</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2: Final Data Set Setup\</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co"># add to dream set</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 1"</span>] <span class="op">=</span> theme_1</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 2"</span>] <span class="op">=</span> theme_2</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 3"</span>] <span class="op">=</span> theme_3</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Sentiment 1"</span>] <span class="op">=</span> sent_1</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Sentiment 2"</span>] <span class="op">=</span> sent_2</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"English Word Count"</span>] <span class="op">=</span> english_word_count</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Orig Word Count"</span>] <span class="op">=</span> native_word_count</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop columns I dont want </span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>dream_data <span class="op">=</span> dream_data .drop(<span class="st">'Remarks'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>dream_data <span class="op">=</span> dream_data .drop(<span class="st">'Proportion artifacts'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>dream_data <span class="op">=</span> dream_data .drop(<span class="st">'Has more data'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>dream_data <span class="op">=</span> dream_data .drop(<span class="st">'Unnamed: 24'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Save back</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>dream_data.to_excel(new_file, header<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co"># 2: Get Cleaner Global Dataset</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns Filename  </span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Case ID   Subject ID  Experience  Treatment group Duration    EEG sample rate Number of EEG channels  </span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Last sleep stage  Has EOG Has EMG Has ECG Proportion artifacts    Time of awakening   Subject age Subject sex </span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Subject healthy   Has more data   Remarks Study   Text of Report  Translation ChatGPT Theme   ChatGPT Sentiment</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Real Dream Narrative</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't need dreams, some other data here</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>clean_file <span class="op">=</span> data_path <span class="op">+</span> <span class="st">"clean_records.xlsx"</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> unclean_df.copy()</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop Columns</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Treatment group'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Remarks'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Proportion artifacts'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Has more data'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Text of Report'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Translation'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'ChatGPT Theme'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'ChatGPT Sentiment'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Unnamed: 24'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>global_data <span class="op">=</span> global_data.drop(<span class="st">'Real Dream Narrative'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>global_data.to_excel(clean_file, header<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(global_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    Filename     Case ID Subject ID  Experience  Duration  \
0     subject010_Morning.edf  10_Morning         10         2.0      73.0   
1        subject010_NREM.edf     10_NREM         10         2.0      73.0   
2         subject010_REM.edf      10_REM         10         2.0      73.0   
3         subject010_SO1.edf      10_SO1         10         0.0      73.0   
4        subject010_SO10.edf     10_SO10         10         2.0      73.0   
...                      ...         ...        ...         ...       ...   
1928         case130_s27.edf         130         27         2.0     120.0   
1929         case131_s27.edf         131         27         2.0     120.0   
1930         case132_s27.edf         132         27         2.0     120.0   
1931         case133_s27.edf         133         27         2.0     120.0   
1932         case134_s27.edf         134         27         2.0     120.0   

      EEG sample rate  Number of EEG channels  Last sleep stage  Has EOG  \
0                 400                      58               5.0        1   
1                 400                      58               2.0        1   
2                 400                      58               5.0        1   
3                 400                      58               1.0        1   
4                 400                      58               2.0        1   
...               ...                     ...               ...      ...   
1928              500                      24               5.0        1   
1929              500                      24               5.0        1   
1930              500                      24               5.0        1   
1931              500                      24               5.0        1   
1932              500                      24               5.0        1   

      Has EMG  Has ECG Time of awakening  Subject age  Subject sex  \
0           1        0          07:17:27         23.0            0   
1           1        0          02:07:02         23.0            0   
2           1        0          03:50:48         23.0            0   
3           1        0          00:16:08         23.0            0   
4           1        0          00:54:12         23.0            0   
...       ...      ...               ...          ...          ...   
1928        1        0          03:19:00         19.0            1   
1929        1        0          04:52:00         19.0            1   
1930        1        0          05:55:00         19.0            1   
1931        1        0          06:29:00         19.0            1   
1932        1        0          07:53:00         19.0            1   

      Subject healthy  Study  
0                   1  Zhang  
1                   1  Zhang  
2                   1  Zhang  
3                   1  Zhang  
4                   1  Zhang  
...               ...    ...  
1928                1  TURKU  
1929                1  TURKU  
1930                1  TURKU  
1931                1  TURKU  
1932                1  TURKU  

[1933 rows x 16 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-visualizations">1.3 Exploratory Visualizations:</h2>
<p>In the following code block, we do some initial visualizations of both slices of data. We look at some attribute distributions with histograms larger aggregate and dream subset datasets to get a high level idea of the data.</p>
<section id="sleep-attributes" class="level3">
<h3 class="anchored" data-anchor-id="sleep-attributes">1.3.1 Sleep Attributes</h3>
<p>First, let’s start with what the sample’s dream experiences and sleep stages look like:</p>
<div id="d6e283d3" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Global data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with some basic histograms:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"ggplot"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.hist(global_data[<span class="st">"Experience"</span>], <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">3</span>), bins <span class="op">=</span> <span class="dv">8</span>, align<span class="op">=</span><span class="st">'mid'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Sleep Experiences for All 10 Studies"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Experience Category"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Experience: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Experience"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation Experience: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Experience"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Experience: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Experience"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-3-output-1.png" width="827" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Experience: 1.36
Standard Deviation Experience: 1.06
Median Experience: 2.0</code></pre>
</div>
</div>
<p>We see that the majority of entries are either 2, or 0 (since the histogram is left aligned). This means that the majority of participants had some recollection of their dreams.</p>
<p>Now looking at the last sleep stage</p>
<div id="2d19e9d3" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plt.hist(global_data[<span class="st">"Last sleep stage"</span>], bins<span class="op">=</span><span class="dv">6</span>, <span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">6</span>), color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Sleep Stages for All 10 Studies"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Sleep Stage"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Last sleep stage"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Last sleep stage"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Last sleep stage"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-4-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Sleep Stage Before Awakening: 2.53
Standard Deviation of Sleep Stage Before Awakening: 1.73
Median Sleep Stage Before Awakening: 2.0</code></pre>
</div>
</div>
<p>we find that oddily, many participants are awoken in NREM (1 - 4) or when not asleep (0). Only ~1/4 of the participants were awoken from REM (5), the stage most commonly associated with dreaming.</p>
</section>
<section id="subject-attributes" class="level3">
<h3 class="anchored" data-anchor-id="subject-attributes">1.3.2 Subject Attributes</h3>
<p>Now looking at Participant attributes, we start with age:</p>
<div id="cccef20b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.hist(global_data[<span class="st">"Subject age"</span>], bins <span class="op">=</span> <span class="dv">20</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Participant Age for All 10 Studies"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age (Years)"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Age: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject age"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Age: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject age"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Age: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject age"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-5-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Age: 25.2 Years
Standard Deviation of Age: 4.62 Years
Median Age: 25.0 Years</code></pre>
</div>
</div>
<p>It is important to look at the participant attributes in this sample so we have an idea of how well our samples represent different populations of sleepers. From the age histogram, we see that participants are mainly centered around 25 years of age. This may make sense since younger people may be more accessible to psych research studies. However, this may mean that our findings may not generalize to other age groups.</p>
<p>Looking at the assigned sex:</p>
<div id="87976290" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.hist(global_data[<span class="st">"Subject sex"</span>], bins <span class="op">=</span> <span class="dv">2</span>, color<span class="op">=</span><span class="st">'pink'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Assigned Participant Sex for All 10 Studies"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Assigned Sex: 0 - Male, 1 - Female"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sex: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject sex"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Sex: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject sex"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Sex: </span><span class="sc">{</span><span class="bu">round</span>(global_data[<span class="st">"Subject sex"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-6-output-1.png" width="827" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Sex: 0.62
Standard Deviation of Sex: 0.58
Median Sex: 1.0</code></pre>
</div>
</div>
<p>we have a majority of participants reporting female, though it is a fairly even split.</p>
</section>
<section id="larger-visuals" class="level3">
<h3 class="anchored" data-anchor-id="larger-visuals">1.3.3 Larger Visuals:</h3>
<p>We now show a correlation matrix heat map of our predictors:</p>
<div id="4377c433" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> global_data[[<span class="st">"Experience"</span>, <span class="st">"Last sleep stage"</span>, <span class="st">"Subject age"</span>, <span class="st">"Subject sex"</span>, <span class="st">"Subject healthy"</span>]].corr()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>sns.diverging_palette(<span class="dv">220</span>, <span class="dv">10</span>, as_cmap<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="fl">1.0</span>, vmax<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    square<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Heat Map of Numeric Values in 10 Study Data"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-7-output-1.png" width="750" height="656" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Interestingly we see some correlation between Age and the last sleep stage. Looking at this in a pair plot</p>
<div id="bec7703b" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(global_data[<span class="st">"Subject age"</span>], global_data[<span class="st">"Last sleep stage"</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Pair Plot of Age and Last Sleep Stage"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age (Years)"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Sleep Stage"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-8-output-1.png" width="802" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>we see that the lower stages skew younger. This is likely due to how different studies focused on different aged participants and different sleep stages. For example the Zhang study limited ages from 18 - 23 and mainly consists of Stage 2 or lower for sleep cycles.</p>
</section>
<section id="dream-data-exploration" class="level3">
<h3 class="anchored" data-anchor-id="dream-data-exploration">1.3.4 Dream Data Exploration:</h3>
<p>We now repeat the above for our Dream Data</p>
<p>For dream experience:</p>
<div id="e4279d72" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dream Subset</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with some basic histograms:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"ggplot"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.hist(dream_data[<span class="st">"Experience"</span>], <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">3</span>), bins <span class="op">=</span> <span class="dv">8</span>, align<span class="op">=</span><span class="st">'mid'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Sleep Experiences for 3 Dream Studies"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Experience Category"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Experience: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Experience"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation Experience: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Experience"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Experience: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Experience"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-9-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Experience: 1.97
Standard Deviation Experience: 0.24
Median Experience: 2.0</code></pre>
</div>
</div>
<p>Looking at the distribution of sleep experiences, we see that most of the non-recall experiences have been pruned out. This was expected from data cleaning, though interestingly some 0s and 1s made it through. This is likely due to either me missing an “I don’t remember” in the reports, or there being substantial recording material despite the researcher’s reporting no recall. These make up a small minority of the data so we’ll leave it for now.</p>
<p>For Last Sleep Stage:</p>
<div id="12c9e70f" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plt.hist(dream_data[<span class="st">"Last sleep stage"</span>], bins<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'cyan'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Sleep Stages for 3 Dream Studies"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Sleep Stage"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Last sleep stage"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Last sleep stage"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Sleep Stage Before Awakening: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Last sleep stage"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-10-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Sleep Stage Before Awakening: 1.27
Standard Deviation of Sleep Stage Before Awakening: 1.6
Median Sleep Stage Before Awakening: 1.0</code></pre>
</div>
</div>
<p>Looking at the histogram of sleep stages we see an interesting distribution. The majority of dream text with recall actually correspond to Sleep Stages 0 - 3, meaning that many entries are from participants that did not fully fall asleep according to the M/EEG. These entries are more like Day Dreams which may have some influence on the data. These likely come from the Zhang study where participants were woken many times during the night. They report that many of the awakenings at stage 0 (before falling asleep) had the best recall, so this likely biases the data that way.</p>
<p>For Age:</p>
<div id="c6834e1b" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.hist(global_data[<span class="st">"Subject age"</span>], bins <span class="op">=</span> <span class="dv">20</span>, color<span class="op">=</span><span class="st">'olive'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Participant Age for 3 Dream Studies"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age (Years)"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Age: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject age"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Age: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject age"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Age: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject age"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> Years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-11-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Age: 24.44 Years
Standard Deviation of Age: 5.47 Years
Median Age: 23.0 Years</code></pre>
</div>
</div>
<p>We see that the average age drops from 25.2 to 24.44. This again may be due to the Zhang study that accounts for ~300 of the 500 remaining dreams. In this study, participants only ranged from 18-23, while the others included other age groups.</p>
<p>Finally the assigned sex breakdown:</p>
<div id="47a5c943" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.hist(dream_data[<span class="st">"Subject sex"</span>], bins <span class="op">=</span> <span class="dv">2</span>, color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Assigned Participant Sex for 3 Dream Studies"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Assigned Sex: 0 - Male, 1 - Female"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Sex: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject sex"</span>].mean(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard Deviation of Sex: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject sex"</span>].std(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median Sex: </span><span class="sc">{</span><span class="bu">round</span>(dream_data[<span class="st">"Subject sex"</span>].median(), <span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-12-output-1.png" width="819" height="529" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Sex: 0.52
Standard Deviation of Sex: 0.5
Median Sex: 1.0</code></pre>
</div>
</div>
<p>we see that the sex breakdown is similar to the larger sample.</p>
<p>Finally, the heat map of the subset:</p>
<div id="5ec40243" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> dream_data[[<span class="st">"Experience"</span>, <span class="st">"Last sleep stage"</span>, <span class="st">"Subject age"</span>, <span class="st">"Subject sex"</span>, <span class="st">"English Word Count"</span>, <span class="st">"Orig Word Count"</span>]].corr()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>sns.diverging_palette(<span class="dv">220</span>, <span class="dv">10</span>, as_cmap<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="fl">1.0</span>, vmax<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    square<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Heat Map of Numeric Values in 3 Study Data"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-13-output-1.png" width="868" height="774" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here we add in the word counts of the dream text as a fun addition in the Original language and the english translation. Interestingly we see the same age and sleep stage.</p>
<p>Looking at the pair plot with color codes based on study group:</p>
<div id="8f0ebb51" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.lines <span class="im">as</span> mlines</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> dream_data[<span class="st">"Study"</span>]:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row <span class="op">==</span> <span class="st">"Zhang"</span>:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="dv">0</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row <span class="op">==</span> <span class="st">"LODE"</span>:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="dv">1</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="dv">2</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(dream_data[<span class="st">"Subject age"</span>], dream_data[<span class="st">"Last sleep stage"</span>], c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Pair Plot of Age and Last Sleep Stage"</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'Zhang'</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'lightseagreen'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'LODE'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>twos <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'gold'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'Oudiette'</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age (Years)"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Sleep Stage"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>[zeros, ones, twos])</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-14-output-1.png" width="802" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is a very intersting plot, because we see that Ouditte contributes many of our non-asleep experiences, and Zhang contributes a longer population.</p>
<p>Both LODE and Oudiette have a better distribution of ages and sleep stages.</p>
<p>Finally, we present our last visual looking at word count vs sleep stage with the same overlay of studies.</p>
<div id="8ff3a62f" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(dream_data[<span class="st">"English Word Count"</span>], dream_data[<span class="st">"Last sleep stage"</span>], c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Pair Plot of Word Count and Last Sleep Stage"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'Zhang'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'Zhang'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'lightseagreen'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'LODE'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>twos <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'gold'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'Oudiette'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Word count"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Sleep Stage"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>[zeros, ones, twos])</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-15-output-1.png" width="802" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From this plot, it looks like word count increases with sleep stage, which could indicate later sleep stages give folks more to talk about. However, we see poor correlation with Experience from the heat map. This may mean that it comes down to a difference in study data collection as the groups appear to be tightly clutered about studies.</p>
<p>These subtle choices in populations and study targets should be kept in mind when communicating our findings. ***</p>
</section>
</section>
</section>
<section id="section-2-project-questions" class="level1">
<h1>Section 2: Project Questions</h1>
<p>There are many interesting questions that could arise from Dream data. For the scope of this course project, we pose 3 main questions to investigate. Below, we state each question clearly with some explanantion on why we want to study it and what visualizations and models and tests are relevant.</p>
<section id="do-dream-stages-correlate-with-dream-experience-recollection" class="level2">
<h2 class="anchored" data-anchor-id="do-dream-stages-correlate-with-dream-experience-recollection">2.1: Do dream stages correlate with dream experience recollection?</h2>
<p>This question is getting at a relationship or correlation between the Experience and Sleep Stage columns in the dataset. We explore if certain sleep stage categories correspond more often with 0s, 1s, or 2s in the experience column.</p>
<p>We investigate this, because it is an example used by Wong, et al.&nbsp;in their paper. They use a Chi-Squared test with a 1500 dream subset of the total dataset and find evidence of some relationship. However, they do not mention how they chose that subset, so we want to try and validate it myself with my 10 study subset.</p>
<p>To try and answer this question, I’ll use a Chi Squared test, as well as a logistic regression model with Experience as the Response and Sleep Stage as the predictor.</p>
</section>
<section id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset">2.2: Can we predict dream experience recollection using more predictors in the dataset?</h2>
<p>This question is asking question 1 in a more broad way. If we have information on sleep stages, participant characterisitics, and awakening times, can we fit a logistic model to predict wether or not one can recollect their dream?</p>
<p>This is a worthwhile exercise because it would indicate something predictable about our dreaming behavior if we can fit a model to it with these attributes. Relevant models will be logistic regression and discriminant analysis because dream recollection is a qualitative response.</p>
</section>
<section id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study">2.3: What is the qualitative distribution of themes and sentiments in this dream study?</h2>
<p>Though more on the high level side, this question is want to look at how the themes and sentiments are distributed across the 3 relevant studies. This includes which key words may show up more than once in a histogram or a word cloud.</p>
<p>This has value in working towards how to analyze such a qualitative and subjective response. Comparing different visualizations and slices of the data may point to interesting characteristics. Visualizations like histograms and word clouds will be helpful, as well as clustering different participants on theme or sentiment.</p>
<p>In the next sections, we investigate these questions with models and visualizations.</p>
<hr>
</section>
</section>
<section id="section-3-models-visualizations" class="level1">
<h1>Section 3: Models + Visualizations</h1>
<p>In the following sections, we include the code, descriptions, and relevant visuals to explore and answer each of the above questions.</p>
<section id="do-dream-stages-correlate-with-dream-experience-recollection-1" class="level2">
<h2 class="anchored" data-anchor-id="do-dream-stages-correlate-with-dream-experience-recollection-1">3.1: Do dream stages correlate with dream experience recollection?</h2>
<p>This question comes directly from the work of Wong, et al.&nbsp;where they take a subset of dreams and perform a Chi Square test for correlation. A Chi Square test is a typical statistical test for the comparison of 2 categorical variables in a frequency table with a null hypothesis that both are independent of one another. When the p value satisfies <span class="math inline">\(p \lt \alpha\)</span> the alternative hypothesis is that there is some correlation between both variables. With a Chi Squared Test with 6 Degrees of freedom, Wong, et al.&nbsp;reports a p-value of <span class="math inline">\(p \lt 10^{-15}\)</span> indicating serious evidence to reject the null hypothesis.</p>
<p>To get this test to work, we need to do some more data manipulation to match the paper. In their paper, Wong, et al.&nbsp;ignore sleep stage 0, and have 1550 examples from sleep stage 1 - 5. They additionally combine the NREM3 and NREM4 stages since some frequency table entries are 0 for these classes. One limitation of the Chi- Square test is that 0s will throw off the test calculations and need to be filled in. We follow these manipulations, getting the frequency table below printed below. As we can see, we get a similar total count of 1548 total data points. This is interestingly close to their result, which gives us pause in assuming their results are based on the full quoted 2649 points.</p>
<p><strong>Actual Chi Square Test</strong></p>
<div id="edb5fe02" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Mask out zeros</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> sc</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#make a combined N3 - N4 column like paper</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>new <span class="op">=</span> []</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> global_data[<span class="st">"Last sleep stage"</span>]:</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">3</span> <span class="kw">or</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        new.append(<span class="dv">3</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        new.append(i)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>global_data[<span class="st">"Adj Last sleep stage"</span>] <span class="op">=</span> new</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Now mask out unwanted data</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>sleep_0_mask <span class="op">=</span> (global_data[<span class="st">"Adj Last sleep stage"</span>]) <span class="op">!=</span> <span class="dv">0</span> </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>exp_mask <span class="op">=</span> (global_data[<span class="st">"Experience"</span>]) <span class="op">&gt;=</span> <span class="dv">0</span> </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Do Chi Square</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>chi_test_df <span class="op">=</span> global_data[sleep_0_mask <span class="op">&amp;</span> exp_mask]</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>cont_table <span class="op">=</span> pd.crosstab(chi_test_df[<span class="st">"Experience"</span>], chi_test_df[<span class="st">"Adj Last sleep stage"</span>], margins<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>cont_table2 <span class="op">=</span> pd.crosstab(chi_test_df[<span class="st">"Experience"</span>], chi_test_df[<span class="st">"Adj Last sleep stage"</span>], margins<span class="op">=</span><span class="va">True</span>, margins_name <span class="op">=</span> <span class="st">"totals"</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Frequency Table:</span><span class="ch">\n</span><span class="st">"</span>, cont_table2, <span class="st">"</span><span class="ch">\n\n\n</span><span class="st">Results:"</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sc.chi2_contingency(cont_table))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Frequency Table:
 Adj Last sleep stage  1.0  2.0  3.0  5.0  totals
Experience                                      
0.0                    13  216   99   70     398
1.0                    10   53   40   13     116
2.0                   114  416   68  436    1034
totals                137  685  207  519    1548 


Results:
Chi2ContingencyResult(statistic=216.57670983750958, pvalue=5.586234282306958e-44, dof=6, expected_freq=array([[ 35.22351421, 176.11757106,  53.22093023, 133.4379845 ],
       [ 10.26614987,  51.33074935,  15.51162791,  38.89147287],
       [ 91.51033592, 457.55167959, 138.26744186, 346.67054264]]))</code></pre>
</div>
</div>
<p>In the above code block we conduct a similar Chi Square test with our 10 study data set. We find that we get a Chi Square statistic of 216.58 and p value of <span class="math inline">\(5.59 \times 10^{-44}\)</span>. This is much smaller than an <span class="math inline">\(\alpha = 0.01\)</span>, so reject the Null hypothesis and say there is sufficient evidence to suggest a correlation between Sleep Stage and Dream Experience, confirming the result in Wong, et al.&nbsp;It is important to note that the Chi Square Test does not tell us how or why 2 categorical variables are related, only if there is evidence of a relationship. We will need to investigate further to tease out what these relationships look like.</p>
<p>Below, we’ll provide a visual of the Chi Square Distribution and the critical value for the <span class="math inline">\(\alpha = 0.01\)</span> significance level. The shaded region shows the critical region at an <span class="math inline">\(\alpha = 0.01\)</span> significance level. We can see that this critical Chi Square value is 15x smaller than the 216.58 value we found in our test.</p>
<div id="8226eed6" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot an example of the result</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">500</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> sc.chi2.pdf(x, df<span class="op">=</span>df)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.plot(x, pdf, label<span class="op">=</span><span class="ss">f'Chi-square PDF (df=</span><span class="sc">{</span>df<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Shade the critical region (alpha = 0.05)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>x_critical <span class="op">=</span> sc.chi2.ppf(<span class="fl">0.99</span>, df)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>x_fill <span class="op">=</span> np.linspace(x_critical, <span class="dv">20</span>, <span class="dv">100</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>y_fill <span class="op">=</span> sc.chi2.pdf(x_fill, df)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>plt.fill_between(x_fill, y_fill, color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, label<span class="op">=</span><span class="st">'Critical Region (α=0.01)'</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and title</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Chi Square Value'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Chi Square Distribution'</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-17-output-1.png" width="823" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We also show a pair wise plot to try and help visualize the relationship</p>
<div id="71a93ff3" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(chi_test_df[<span class="st">"Adj Last sleep stage"</span>], chi_test_df[<span class="st">"Experience"</span>], color<span class="op">=</span><span class="st">"purple"</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Scatter plot of Experience vs Sleep Stage"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Adj Sleep Stage"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Experience"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-18-output-1.png" width="823" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>However, we find some limitation of our 2D plot. Since these are categorical variables, many points fall on the same scatter plot location. We use a high transpartency to try and get the different densitities to show up, but any relationship is not distinguishable by eye. Our frequency table in the previous block proved to be a better visualization.</p>
<p>This suggests that there is strong evidence that Sleep Experience and Last Sleep Stage have some sort of correlation. We’ll now investigate this with a logistic regression model in section 3.2.</p>
</section>
<section id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset-1">3.2 Can we predict dream experience recollection using more predictors in the dataset?</h2>
<p>To answer this question, we use a simple multi class logistic regression model. This is appropriate in this case because we will treat experience as a categorical response variable with class labels 0, 1, and 2. We do not know enough at this point to guess important predictors, so we will try to fit a model with just the Adj Last Sleep Stage like we did in section 3.1 in the Chi Square test as a baseline. We will also fit a model with all of the relevant predictors (Subject age, Subject sex, Subject healthy, Adj Sleep Stage). We could also make new variables for study, since this could plausibly affect sleep patterns, but we choose not to. We are concerned that since each study has different awakening procedures and focuses on certain sleep stages, so we may be confounding with sleep stage. Additionally, this ommission means we assume all studies are coming from the same distribution which we should not assume.</p>
<section id="single-predictor-multinomial-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="single-predictor-multinomial-logistic-regression">3.2.1 Single Predictor Multinomial Logistic Regression</h3>
<p>In the below code block we fit a basic logistic model with Experience as the Response and Adj Sleep Stage as the predictor. We use the statsmodels library, because it provides a similar model summary to R with coefficients and p values. We fit a multinomial logistic model because we have 3 classes for the response (0 - No Experience, 1 - Experience without Recall, 2 - Experience with Recall). We do not transform the data past dropping NaNs in the next two sections, which we will see has serious consequences on the resulting models.</p>
<p>We use a simple validation set approach to estimate the test accuracy. We randomly select 20% of the data for validation accuracy, and train on the remaining 80%. We will use this scheme in each subsequent model. We could expand this with a cross validation scheme, but we do not find good model accuracy in the first place and would save this for a setting where the focus was better model selection.</p>
<div id="0cad7b6f" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.lines <span class="im">as</span> mlines</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>x_cols <span class="op">=</span> [<span class="st">"Time of awakening"</span>,<span class="st">"Subject age"</span>,<span class="st">"Subject sex"</span>,<span class="st">"Subject healthy"</span>, <span class="st">"Adj Last sleep stage"</span>]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>cleandf <span class="op">=</span> chi_test_df.dropna()</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#cleandf =  pd.get_dummies(cleandf, columns=['Adj Last sleep stage'])</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> cleandf[[<span class="st">"Adj Last sleep stage"</span>]]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> cleandf[[<span class="st">"Experience"</span>]]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Try with sm</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>glm_model <span class="op">=</span> sm.MNLogit(y_train, X_train)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> glm_model.fit()</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> est.predict(X_test)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="op">=</span> np.argmax(predictions, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix </span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, predicted_classes)  </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Confusion Matrix : </span><span class="ch">\n</span><span class="st">"</span>, cm)  </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy score of the model </span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation Accuracy = '</span>, accuracy_score(y_test, predicted_classes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.665657
         Iterations 7
                          MNLogit Regression Results                          
==============================================================================
Dep. Variable:             Experience   No. Observations:                  880
Model:                        MNLogit   Df Residuals:                      876
Method:                           MLE   Df Model:                            2
Date:                Thu, 20 Mar 2025   Pseudo R-squ.:                 0.01507
Time:                        12:06:54   Log-Likelihood:                -585.78
converged:                       True   LL-Null:                       -594.74
Covariance Type:            nonrobust   LLR p-value:                 0.0001280
========================================================================================
        Experience=1       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                   -2.8057      0.489     -5.737      0.000      -3.764      -1.847
Adj Last sleep stage     0.2034      0.139      1.462      0.144      -0.069       0.476
----------------------------------------------------------------------------------------
        Experience=2       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                    0.4205      0.172      2.445      0.014       0.083       0.758
Adj Last sleep stage     0.2206      0.053      4.132      0.000       0.116       0.325
========================================================================================
Confusion Matrix : 
 [[  0   0  52]
 [  0   0   7]
 [  0   0 161]]
Validation Accuracy =  0.7318181818181818</code></pre>
</div>
</div>
<section id="interpreting-the-model" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-model">Interpreting the Model</h4>
<p>For our model interpretation, we look at the summary above. This is a mulitnomial regression so we are looking at 2 combined LRs of Exp 1 or not, and Exp 2 or not. From the summary table after fitting, we see that our Sleep Stage predictor has a postive coefficient for each fit. This means that the larger the sleep stage, the more likely a recalled experience. This is an odd way to build a model for a categorical predictor like sleep stages since it inherently makes it a discreet numerical value. However, we can make the case that we are really testing how deep into a sleep cycle someone is affects their recall so the higher the stage, the deeper they are. We’ll touch more on these modeling assumptions, which will held throughout this section later in section 4.</p>
<p>Looking at the significance of the coefficients, we see a p value of 0.144 for predicting Experience without recall or not, and a p value $ ^{-3}$ for predicting Experience with recall or not. This means that at the <span class="math inline">\(\alpha = 0.01\)</span> level, we do not have sufficient evidence to reject the null hypothesis in case 1, but do in case 2 that the Adjusted Sleep Stage in significant in predicting the experience.</p>
</section>
<section id="interpreting-the-initial-results" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-initial-results">Interpreting the Initial Results</h4>
<p>On first glance, we find that we get a good test accuracy of ~73%! Unfortunately, looking at the confusion matrix we see that our model trivially chooses the class 2 - Experience with Recall everytime. This is likely because we have 3x examples of that label compared to others. We will test this in the later code.</p>
</section>
</section>
<section id="multiple-predictor-multinomial-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="multiple-predictor-multinomial-logistic-regression">3.2.2 Multiple Predictor Multinomial Logistic Regression</h3>
<p>For completeness, we repeat the above model fit with more participant predictors including [“Subject age”,“Subject sex”,“Subject healthy”]. We chose these predictors because they were easy to add into the model and could plausibly have some effect on sleep experience.</p>
<div id="8ed40bb7" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x_cols <span class="op">=</span> [<span class="st">"Time of awakening"</span>,<span class="st">"Subject age"</span>,<span class="st">"Subject sex"</span>,<span class="st">"Subject healthy"</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>cleandf <span class="op">=</span> chi_test_df.dropna()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> cleandf[[<span class="st">"Subject age"</span>,<span class="st">"Subject sex"</span>,<span class="st">"Subject healthy"</span>, <span class="st">"Adj Last sleep stage"</span>]]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> cleandf[[<span class="st">"Experience"</span>]]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Try with sm</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>glm_model <span class="op">=</span> sm.MNLogit(y_train, X_train)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> glm_model.fit()</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> est.predict(X_test)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="op">=</span> np.argmax(predictions, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix </span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, predicted_classes) </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Confusion Matrix : </span><span class="ch">\n</span><span class="st">"</span>, cm)  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy score of the model </span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation Accuracy = '</span>, accuracy_score(y_test, predicted_classes)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.661362
         Iterations 8
                          MNLogit Regression Results                          
==============================================================================
Dep. Variable:             Experience   No. Observations:                  880
Model:                        MNLogit   Df Residuals:                      872
Method:                           MLE   Df Model:                            6
Date:                Thu, 20 Mar 2025   Pseudo R-squ.:                 0.02143
Time:                        12:06:54   Log-Likelihood:                -582.00
converged:                       True   LL-Null:                       -594.74
Covariance Type:            nonrobust   LLR p-value:                 0.0002775
========================================================================================
        Experience=1       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Subject age              0.0497      0.048      1.040      0.299      -0.044       0.143
Subject sex              0.9449      0.492      1.922      0.055      -0.019       1.909
Subject healthy         -4.6272      1.323     -3.498      0.000      -7.220      -2.034
Adj Last sleep stage     0.1884      0.141      1.332      0.183      -0.089       0.465
----------------------------------------------------------------------------------------
        Experience=2       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Subject age              0.0311      0.019      1.650      0.099      -0.006       0.068
Subject sex              0.1270      0.160      0.794      0.427      -0.187       0.440
Subject healthy         -0.3911      0.483     -0.810      0.418      -1.338       0.556
Adj Last sleep stage     0.2080      0.054      3.868      0.000       0.103       0.313
========================================================================================
Confusion Matrix : 
 [[  0   0  52]
 [  0   0   7]
 [  0   0 161]]
Validation Accuracy =  0.7318181818181818</code></pre>
</div>
</div>
<section id="interpreting-the-model-1" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-model-1">Interpreting the Model</h4>
<p>From the summary table after fitting, we see that our Sleep Stage predictor has a postive coefficient for each fit. We also see positive cooefficients on age and sex, which is a bit odd to interpret. This means that participants with the assigned sex Female and older participants are more likely to recall their dreams. Subject healthy has a negative coefficient meaning that those without sleep disorders are less likely to recall as well. These are a bit bizarre to think about and may not be great predictors after all from an interpretability level.</p>
<p>Looking at the significance of the coefficients, we find that age and sex are not siginificant at the <span class="math inline">\(\alpha = 0.01\)</span> level, while the sleep stage and health are depending on the class.</p>
</section>
<section id="interpreting-the-initial-results-1" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-initial-results-1">Interpreting the Initial Results</h4>
<p>Again, we find that we get a good test accuracy of ~73%! Unfortunately, looking at the confusion matrix we see that our model again trivially chooses the class 2 - Experience with Recall everytime.</p>
</section>
</section>
<section id="multinomial-logistic-regression-with-balanced-classes" class="level3">
<h3 class="anchored" data-anchor-id="multinomial-logistic-regression-with-balanced-classes">3.2.3: Multinomial Logistic Regression with balanced classes</h3>
<p>We now repeat the fitting of 3.2.1 and 3.2.2, but add duplicate rows to balance out the Response labels. We could choose other means of trying to balance out the classes, with either interpolation or stratification. But, for simplicity we add duplicates to nudge the model to fairly weight each class. This has a large downside of not providing more information to learn better weights.</p>
<div id="5be1f1ef" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now try to balance class weights:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>new_exp <span class="op">=</span> []</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>new_ad_ss <span class="op">=</span> []</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> cleandf.values.tolist():</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 3 -&gt; exp</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 7 ss</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="dv">3</span>] <span class="op">==</span> <span class="fl">1.0</span>:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]<span class="op">*</span><span class="dv">22</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]<span class="op">*</span><span class="dv">22</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="dv">3</span>] <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>newdf <span class="op">=</span> pd.DataFrame()</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Experience"</span>] <span class="op">=</span> new_exp</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Adj Last sleep stage"</span>] <span class="op">=</span> new_ad_ss</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> newdf[[<span class="st">"Adj Last sleep stage"</span>]]</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> newdf[[<span class="st">"Experience"</span>]]</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Try with sm</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>glm_model <span class="op">=</span> sm.MNLogit(y_train, X_train)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> glm_model.fit()</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> est.predict(X_test)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="op">=</span> np.argmax(predictions, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix </span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, predicted_classes)  </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Confusion Matrix : </span><span class="ch">\n</span><span class="st">"</span>, cm)  </span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy score of the model </span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation accuracy = '</span>, accuracy_score(y_test, predicted_classes))</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">"Adj Last sleep stage"</span>], y_test[<span class="st">"Experience"</span>], c<span class="op">=</span>predicted_classes, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Scatter plot of Experience vs Sleep Stage - Single Pred. Model"</span>)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Adj Sleep Stage"</span>)</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Experience"</span>)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'0 - No Dream Experience'</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'blue'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'1 - Dream Experience without Recall'</span>)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>twos <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'yellow'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'2 - Dream Experience with Recall'</span>)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>[zeros, ones, twos])</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Single_MNL_Plot"</span>)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 1.087084
         Iterations 4
                          MNLogit Regression Results                          
==============================================================================
Dep. Variable:             Experience   No. Observations:                 1831
Model:                        MNLogit   Df Residuals:                     1827
Method:                           MLE   Df Model:                            2
Date:                Thu, 20 Mar 2025   Pseudo R-squ.:                0.007915
Time:                        12:06:54   Log-Likelihood:                -1990.5
converged:                       True   LL-Null:                       -2006.3
Covariance Type:            nonrobust   LLR p-value:                 1.270e-07
========================================================================================
        Experience=1       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                   -0.6371      0.131     -4.860      0.000      -0.894      -0.380
Adj Last sleep stage     0.1654      0.040      4.128      0.000       0.087       0.244
----------------------------------------------------------------------------------------
        Experience=2       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                   -0.5874      0.126     -4.652      0.000      -0.835      -0.340
Adj Last sleep stage     0.2041      0.038      5.326      0.000       0.129       0.279
========================================================================================
Confusion Matrix : 
 [[123   0  47]
 [ 79   0  57]
 [ 81   0  71]]
Validation accuracy =  0.42358078602620086</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-21-output-2.png" width="823" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="interpreting-the-single-predictor-model" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-single-predictor-model">Interpreting the Single Predictor Model</h4>
<p>From the summary table after fitting, we see that our Sleep Stage predictor has a postive coefficient for each fit.</p>
<p>Looking at the significance of the coefficients we now find that sleep stage is signficant at <span class="math inline">\(\alpha = 0.01\)</span> level for both classes!</p>
</section>
<section id="interpreting-the-initial-results-2" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-initial-results-2">Interpreting the Initial Results</h4>
<p>Now we get an estimated accuracy of only 0.43 which is only slightly better than random. Looking at the confusion matrix. we no longer have a trivial classifier, but we get no predictions for class 1 - Experience Without Recall. This is a strange result, which may suggest that our method for duplication may not have been totally sufficient. With only 7 unique data points, there might not be enough data to make class 1 distinguishable from the others. However, this is progress in the right direction!</p>
<p>Now we’ll fit the multi-predictor case:</p>
<div id="737b75d9" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>new_exp <span class="op">=</span> []</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>new_ad_ss <span class="op">=</span> []</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>new_ss <span class="op">=</span> []</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>new_sa <span class="op">=</span> []</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>new_sh <span class="op">=</span> []</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> cleandf.values.tolist():</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 3 -&gt; exp</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 12 sa</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 13 ss</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 14 sh</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i = 16 adj</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="dv">3</span>] <span class="op">==</span> <span class="fl">1.0</span>:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        scale <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]<span class="op">*</span>scale</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]<span class="op">*</span>scale</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        new_sa <span class="op">+=</span> [row[<span class="dv">12</span>]]<span class="op">*</span>scale</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        new_ss <span class="op">+=</span> [row[<span class="dv">13</span>]]<span class="op">*</span>scale</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        new_sh <span class="op">+=</span> [row[<span class="dv">14</span>]]<span class="op">*</span>scale</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row[<span class="dv">3</span>] <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        new_sa <span class="op">+=</span> [row[<span class="dv">12</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        new_ss <span class="op">+=</span> [row[<span class="dv">13</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        new_sh <span class="op">+=</span> [row[<span class="dv">14</span>]]<span class="op">*</span><span class="dv">3</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        new_exp <span class="op">+=</span> [row[<span class="dv">3</span>]]</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        new_ad_ss <span class="op">+=</span> [row[<span class="dv">16</span>]]</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        new_sa <span class="op">+=</span> [row[<span class="dv">12</span>]]</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        new_ss <span class="op">+=</span> [row[<span class="dv">13</span>]]</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        new_sh <span class="op">+=</span> [row[<span class="dv">14</span>]]</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>newdf <span class="op">=</span> pd.DataFrame()</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Experience"</span>] <span class="op">=</span> new_exp</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Adj Last sleep stage"</span>] <span class="op">=</span> new_ad_ss</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Subject age"</span>] <span class="op">=</span> new_sa</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Subject sex"</span>] <span class="op">=</span> new_ss</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>newdf[<span class="st">"Subject healthy"</span>] <span class="op">=</span> new_sh</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>x_cols <span class="op">=</span> [<span class="st">"Time of awakening"</span>,<span class="st">"Subject age"</span>,<span class="st">"Subject sex"</span>,<span class="st">"Subject healthy"</span>, <span class="st">"Adj Last sleep stage"</span>]</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> newdf[[<span class="st">"Subject age"</span>,<span class="st">"Subject sex"</span>,<span class="st">"Subject healthy"</span>, <span class="st">"Adj Last sleep stage"</span>]]</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> newdf[[<span class="st">"Experience"</span>]]</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Try with sm</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>glm_model <span class="op">=</span> sm.MNLogit(y_train, X_train)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> glm_model.fit()</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> est.predict(X_test)</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="op">=</span> np.argmax(predictions, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix </span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, predicted_classes)  </span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Confusion Matrix : </span><span class="ch">\n</span><span class="st">"</span>, cm)  </span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy score of the model </span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation accuracy = '</span>, accuracy_score(y_test, predicted_classes))</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">"Adj Last sleep stage"</span>], y_test[<span class="st">"Experience"</span>], c<span class="op">=</span>predicted_classes, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Scatter plot of Experience vs Sleep Stage: Multi Pred. Model"</span>)</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Adj Sleep Stage"</span>)</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Experience"</span>)</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'0 - No Dream Experience'</span>)</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'blue'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'1 - Dream Experience without Recall'</span>)</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>twos <span class="op">=</span> mlines.Line2D([], [], color<span class="op">=</span><span class="st">'yellow'</span>, marker<span class="op">=</span><span class="st">'o'</span>, ls<span class="op">=</span><span class="st">''</span>, label<span class="op">=</span><span class="st">'2 - Dream Experience with Recall'</span>)</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>[zeros, ones, twos])</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Multi_MNL_Plot.png"</span>)</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 1.057163
         Iterations 5
                          MNLogit Regression Results                          
==============================================================================
Dep. Variable:             Experience   No. Observations:                 1831
Model:                        MNLogit   Df Residuals:                     1823
Method:                           MLE   Df Model:                            6
Date:                Thu, 20 Mar 2025   Pseudo R-squ.:                 0.03522
Time:                        12:06:54   Log-Likelihood:                -1935.7
converged:                       True   LL-Null:                       -2006.3
Covariance Type:            nonrobust   LLR p-value:                 5.255e-28
========================================================================================
        Experience=1       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Subject age              0.0416      0.015      2.826      0.005       0.013       0.070
Subject sex              1.2021      0.131      9.175      0.000       0.945       1.459
Subject healthy         -2.4939      0.397     -6.286      0.000      -3.271      -1.716
Adj Last sleep stage     0.1707      0.041      4.114      0.000       0.089       0.252
----------------------------------------------------------------------------------------
        Experience=2       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Subject age              0.0172      0.014      1.230      0.219      -0.010       0.045
Subject sex              0.2315      0.113      2.041      0.041       0.009       0.454
Subject healthy         -1.1400      0.368     -3.102      0.002      -1.860      -0.420
Adj Last sleep stage     0.2020      0.039      5.244      0.000       0.127       0.277
========================================================================================
Confusion Matrix : 
 [[70 81 19]
 [24 85 27]
 [50 58 44]]
Validation accuracy =  0.4344978165938865</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-22-output-2.png" width="823" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpreting-the-single-predictor-model-1" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-single-predictor-model-1">Interpreting the Single Predictor Model</h4>
<p>From the summary table after fitting, we see that the signs of coefficients match the previous case.</p>
<p>Looking at the significance of the coefficients we now find that sleep stage and healthy are again signficant at <span class="math inline">\(\alpha = 0.01\)</span> level for both classes, but now age and sex also are significant in predicting class 1. This may be because with less unique data, the model needs all it can get from the predictors to help differentiate class 1 on the training data.</p>
</section>
<section id="interpreting-the-initial-results-3" class="level4">
<h4 class="anchored" data-anchor-id="interpreting-the-initial-results-3">Interpreting the Initial Results</h4>
<p>Again we get an estimated accuracy of only 0.43 which suggests that adding predictors did not help the model too much.</p>
<p>From these experiments, we may want to conclude that our simple model assumption for logistic regression is not sufficient to model the sleep experiences.</p>
</section>
</section>
</section>
<section id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study-1" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study-1">3.3: What is the qualitative distribution of themes and sentiments in this dream study?</h2>
<p>In investigating this questions, we rely on more qualitative means than the previous 2. To better understand the distribution of themes and sentiment, we use histograms and word clouds to explore different slices of the data. These are useful tools to pull out qualities by eye and may point us in a direction of questions to ask in the future.</p>
<p>For this section, we use the 550 dream examples with text. In the below code blocks, we take different slices of the data and compare histograms by study and overall. We filter out words that appear <span class="math inline">\(\lt\)</span> 3 or 4 times from the histograms to make them readable. We also print the frequencies of words with 2 (or 3) or more counts for more exploration.</p>
<div id="1cb65b0c" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make histgrams of themes and sentiment</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 1"</span>] <span class="op">=</span> [x.lower().strip() <span class="cf">for</span> x <span class="kw">in</span> dream_data[<span class="st">"Theme 1"</span>]]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>t1_freq <span class="op">=</span> dream_data[<span class="st">"Theme 1"</span>].value_counts()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>t1_vals <span class="op">=</span> t1_freq[t1_freq <span class="op">&gt;=</span> <span class="dv">4</span>].index</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 1"</span>].isin(t1_vals)]</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>plt.hist(filtered_df[<span class="st">"Theme 1"</span>], bins<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Theme 1 Words with Count &gt; 3"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-23-output-1.png" width="1087" height="508" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="acaf4df5" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>t1_freq <span class="op">=</span> dream_data[<span class="st">"Theme 1"</span>].value_counts()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>t1_vals <span class="op">=</span> t1_freq[t1_freq <span class="op">&gt;=</span> <span class="dv">2</span>].index</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 1"</span>].isin(t1_vals)]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> filtered_df[<span class="st">"Theme 1"</span>].value_counts()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Theme 1
friendship                 15
family                     10
memory                      9
travel                      9
food                        8
reflection                  8
music                       6
sleep                       5
game                        5
work                        5
journey                     4
nostalgia                   4
hunger                      4
home                        4
research                    4
relaxation                  4
exploration                 4
school                      3
solitude                    3
hospital                    3
experiment                  3
escape                      3
baseball                    3
anxiety                     3
nature                      3
celebrity                   3
conflict                    2
self-reflection             2
family gathering            2
movement                    2
vacation                    2
decision-making journey     2
dinner preparation          2
decision-making             2
anticipation                2
tennis                      2
time                        2
adventure                   2
shopping                    2
communication               2
control                     2
revolution                  2
dancing                     2
comfort                     2
frustration                 2
wealth                      2
art                         2
soccer                      2
study                       2
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="143f1d4e" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make histgrams of themes and sentiment</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make histgrams of themes and sentiment</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 2"</span>] <span class="op">=</span> [x.lower().strip() <span class="cf">for</span> x <span class="kw">in</span> dream_data[<span class="st">"Theme 2"</span>]]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>t2_freq <span class="op">=</span> dream_data[<span class="st">"Theme 2"</span>].value_counts()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>t2_vals <span class="op">=</span> t2_freq[t2_freq <span class="op">&gt;=</span> <span class="dv">4</span>].index</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 2"</span>].isin(t2_vals)]</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>plt.hist(filtered_df[<span class="st">"Theme 2"</span>], bins<span class="op">=</span><span class="dv">400</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Theme 2 Words with Count &gt; 3"</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-25-output-1.png" width="1096" height="508" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="eaa95948" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>t2_freq <span class="op">=</span> dream_data[<span class="st">"Theme 2"</span>].value_counts()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>t2_vals <span class="op">=</span> t2_freq[t2_freq <span class="op">&gt;=</span> <span class="dv">3</span>].index</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 2"</span>].isin(t2_vals)]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> filtered_df[<span class="st">"Theme 2"</span>].value_counts()</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Theme 2
na               112
reflection        13
friendship        12
memory            11
uncertainty        6
music              6
family             6
sleep              5
conversation       5
transition         4
challenge          4
movement           4
movies             4
strategy           4
trick              4
relationship       3
planning           3
relationships      3
anxiety            3
nature             3
conflict           3
journey            3
rest               3
nostalgia          3
shopping           3
relaxation         3
sports             3
anticipation       3
routine            3
pursuit            3
home               3
fear               3
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="ff16b29a" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dream_data[<span class="st">"Theme 3"</span>] <span class="op">=</span> [x.lower().strip() <span class="cf">for</span> x <span class="kw">in</span> dream_data[<span class="st">"Theme 3"</span>]]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>t3_freq <span class="op">=</span> dream_data[<span class="st">"Theme 3"</span>].value_counts()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>t3_vals <span class="op">=</span> t3_freq[t3_freq <span class="op">&gt;=</span> <span class="dv">4</span>].index</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 3"</span>].isin(t3_vals)]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>plt.hist(filtered_df[<span class="st">"Theme 3"</span>], bins<span class="op">=</span><span class="dv">400</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Theme 3 Words with Count &gt; 3"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-27-output-1.png" width="1096" height="508" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2f699d89" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>t3_freq <span class="op">=</span> dream_data[<span class="st">"Theme 3"</span>].value_counts()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>t3_vals <span class="op">=</span> t3_freq[t3_freq <span class="op">&gt;=</span> <span class="dv">2</span>].index</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> dream_data[dream_data[<span class="st">"Theme 3"</span>].isin(t3_vals)]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> filtered_df[<span class="st">"Theme 3"</span>].value_counts()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Theme 3
na                180
reflection          8
memory              8
travel              8
preparation         4
transition          4
exploration         4
friendship          4
confusion           4
transformation      4
music               4
thoughts            4
conflict            4
family              3
simplicity          3
shopping            3
repetition          3
loss                3
nostalgia           3
food                3
connection          3
activity            3
time                3
anticipation        3
completion          3
movement            3
choices             2
sleep               2
organization        2
relaxation          2
distraction         2
planning            2
journey             2
discovery           2
discomfort          2
youth               2
work                2
fun                 2
nature              2
guidance            2
white noise         2
game                2
disruption          2
communication       2
resistance          2
decision            2
fragmentation       2
observation         2
objects             2
perception          2
effort              2
imagination         2
technology          2
power               2
relationships       2
group               2
survival            2
uncertainty         2
reconciliation      2
Name: count, dtype: int64</code></pre>
</div>
</div>
<section id="interpretation-of-histograms" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-histograms">Interpretation of Histograms</h4>
<p>From these basic histograms we can pull out that some themes like friendship, reflection, memory, and family are high hitters. The NA category means that ChatGPT did not spit out a 2nd or 3rd theme with a comma separation. We found that in many cases ChatGPT would deliver 3 one-word themes, but sometimes a multiword theme was given so some theme 2 and 3 entries were blank. With 550 entries, it is surprising to not see too much overlap in 1st position themes, but that these key words were the top in all theme positions.</p>
<div id="caeec16c" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregated themes</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>themes <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> dream_data[<span class="st">"Theme 1"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> dream_data[<span class="st">"Theme 2"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> dream_data[<span class="st">"Theme 3"</span>]]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>themes_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>themes_df[<span class="st">"Themes"</span>] <span class="op">=</span> themes</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> themes_df[<span class="st">"Themes"</span>].value_counts()</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(freq)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average Frequency:"</span>, freq.mean())</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"StD of Frequency:"</span>, freq.std())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Themes
na                         292
friendship                  31
reflection                  29
memory                      28
family                      19
                          ... 
bike                         1
train journey decision       1
movie reflection             1
hunger and anticipation      1
obstacles                    1
Name: count, Length: 746, dtype: int64
Average Frequency: 2.1152815013404824
StD of Frequency: 10.920707858101167</code></pre>
</div>
</div>
<div id="4337a9ef" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> freq[freq <span class="op">&gt;=</span> <span class="dv">10</span>].index</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> themes_df[themes_df[<span class="st">"Themes"</span>].isin(vals)]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> filtered_df[<span class="st">"Themes"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> filtered_df[mask]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.hist(filtered_df[<span class="st">"Themes"</span>], bins<span class="op">=</span><span class="dv">400</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Theme 3 Words with Count &gt; 3"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-30-output-1.png" width="1087" height="508" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-of-histograms-1" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-histograms-1">Interpretation of Histograms</h4>
<p>From the aggregated histogram we don’t see anything surprising. Once we removed the NA bar we see the same high hitters as before.</p>
</section>
<section id="sentiment-histograms" class="level3">
<h3 class="anchored" data-anchor-id="sentiment-histograms">Sentiment Histograms</h3>
<p>We’ll repeate the total histograms with the sentiments:</p>
<div id="8d35ef09" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregated sentiments</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ses <span class="op">=</span> [i.lower().strip() <span class="cf">for</span> i <span class="kw">in</span> dream_data[<span class="st">"Sentiment 1"</span>]] <span class="op">+</span> [i.lower().strip() <span class="cf">for</span> i <span class="kw">in</span> dream_data[<span class="st">"Sentiment 2"</span>]]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ses_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>ses_df[<span class="st">"Sentiments"</span>] <span class="op">=</span> ses</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> ses_df[<span class="st">"Sentiments"</span>].value_counts()</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(freq)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average Frequency:"</span>, freq.mean())</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"StD of Frequency:"</span>, freq.std())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sentiments
na                       134
neutral                  103
reflective                54
calm                      39
nostalgic                 33
                        ... 
subdued reflection         1
curious interest           1
thoughtful reflection      1
exciting                   1
responsibility             1
Name: count, Length: 319, dtype: int64
Average Frequency: 3.2978056426332287
StD of Frequency: 10.524112544779545</code></pre>
</div>
</div>
<div id="1d902e6d" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> freq[freq <span class="op">&gt;=</span> <span class="dv">10</span>].index</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> ses_df[ses_df[<span class="st">"Sentiments"</span>].isin(vals)]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> filtered_df[<span class="st">"Sentiments"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> filtered_df[mask]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.hist(filtered_df[<span class="st">"Sentiments"</span>], bins<span class="op">=</span><span class="dv">400</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Sentiment Words with Count &gt; 10"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-32-output-1.png" width="1096" height="508" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-of-histograms-2" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-histograms-2">Interpretation of Histograms</h4>
<p>From the aggregated histogram we see that Neutral, Calm, Reflective, and other words fitting a detatched retelling’s sentiment are the top hitters. This fits intuitively into what we should expect. These dream tellings are typically told like a 1st person explanation of the scene and tend to feel disconnected from an emotion in the transcription. So, a neutral sentiment makes sense. We tried to filter out uncertainty from this list in our prompt to ChatGPT, as many recordings sounded unsure of what exactly happened in the dream. This confirms that our prompt adjustments were useful.</p>
<p>However, past these initial checks, we are not sure how useful this analysis and visual really is. It helps confirm that the stories were told with similar sentiment, but not much past that.</p>
</section>
</section>
<section id="word-clouds" class="level3">
<h3 class="anchored" data-anchor-id="word-clouds">3.3.3 Word Clouds</h3>
<p>We now offer another visualization of the themes with Word clouds. For another interesting slice, we look at the aggregate data and data partitioned by study group to compare.</p>
<div id="d9bd8f8b" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> STOPWORDS</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a little pre processing</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> themes_df[<span class="st">"Themes"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> themes_df[mask]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(filtered_df[<span class="st">'Themes'</span>].astype(<span class="bu">str</span>).tolist())</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> re.sub(<span class="vs">r'[^A-Za-z\s]'</span>, <span class="st">''</span>, text)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> text.lower()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>stopwords <span class="op">=</span> <span class="bu">set</span>(STOPWORDS)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stopwords)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a word cloud</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>).generate(text)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)  </span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Aggregated Extracted Themes"</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Big_WC.png"</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-33-output-1.png" width="763" height="414" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="adb7a4c6" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>z_mask <span class="op">=</span> dream_data[<span class="st">"Study"</span>] <span class="op">==</span> <span class="st">"Zhang"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>z_dream_data <span class="op">=</span> dream_data[z_mask]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>z_themes <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> z_dream_data[<span class="st">"Theme 1"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> z_dream_data[<span class="st">"Theme 2"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> z_dream_data[<span class="st">"Theme 3"</span>]]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>z_themes_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>z_themes_df[<span class="st">"Themes"</span>] <span class="op">=</span> z_themes</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>zt_mask <span class="op">=</span> z_themes_df[<span class="st">"Themes"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>z_filtered_df <span class="op">=</span> z_themes_df[zt_mask]</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Study Zhang</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(z_filtered_df[<span class="st">'Themes'</span>].astype(<span class="bu">str</span>).tolist())</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> re.sub(<span class="vs">r'[^A-Za-z\s]'</span>, <span class="st">''</span>, text)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> text.lower()</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>stopwords <span class="op">=</span> <span class="bu">set</span>(STOPWORDS)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stopwords)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a word cloud</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>).generate(text)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)  </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Zhang Extracted Themes"</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-34-output-1.png" width="763" height="414" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1115fc6f" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for Oudiette</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>o_mask <span class="op">=</span> dream_data[<span class="st">"Study"</span>] <span class="op">==</span> <span class="st">"Oudiette"</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>o_dream_data <span class="op">=</span> dream_data[o_mask]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>o_themes <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> o_dream_data[<span class="st">"Theme 1"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> o_dream_data[<span class="st">"Theme 2"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> o_dream_data[<span class="st">"Theme 3"</span>]]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>o_themes_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>o_themes_df[<span class="st">"Themes"</span>] <span class="op">=</span> o_themes</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>ot_mask <span class="op">=</span> o_themes_df[<span class="st">"Themes"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>o_filtered_df <span class="op">=</span> o_themes_df[ot_mask]</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(o_filtered_df[<span class="st">'Themes'</span>].astype(<span class="bu">str</span>).tolist())</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> re.sub(<span class="vs">r'[^A-Za-z\s]'</span>, <span class="st">''</span>, text)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> text.lower()</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>stopwords <span class="op">=</span> <span class="bu">set</span>(STOPWORDS)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stopwords)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a word cloud</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>).generate(text)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)  </span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Oudiette Extracted Themes"</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-35-output-1.png" width="763" height="414" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9d884ddf" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for LODE</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>l_mask <span class="op">=</span> dream_data[<span class="st">"Study"</span>] <span class="op">==</span> <span class="st">"LODE"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>l_dream_data <span class="op">=</span> dream_data[l_mask]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>l_themes <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> l_dream_data[<span class="st">"Theme 1"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> l_dream_data[<span class="st">"Theme 2"</span>]] <span class="op">+</span> [i <span class="cf">for</span> i <span class="kw">in</span> l_dream_data[<span class="st">"Theme 3"</span>]]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>l_themes_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>l_themes_df[<span class="st">"Themes"</span>] <span class="op">=</span> o_themes</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>lt_mask <span class="op">=</span> l_themes_df[<span class="st">"Themes"</span>] <span class="op">!=</span> <span class="st">"na"</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>l_filtered_df <span class="op">=</span> l_themes_df[lt_mask]</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(l_filtered_df[<span class="st">'Themes'</span>].astype(<span class="bu">str</span>).tolist())</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> re.sub(<span class="vs">r'[^A-Za-z\s]'</span>, <span class="st">''</span>, text)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> text.lower()</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>stopwords <span class="op">=</span> <span class="bu">set</span>(STOPWORDS)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stopwords)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a word cloud</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>).generate(text)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)  </span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"LODE Extracted Themes"</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Final_files/figure-html/cell-36-output-1.png" width="763" height="414" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-of-word-clouds" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-word-clouds">Interpretation of Word Clouds</h4>
<p>Word clouds offer an interesting qualitative visual. Word sizes are based on the frequency of a given word. We see that for the LODE and Oudiette studies, Reflection is the most striking theme, while memory and friendship are the most eye catching in Zhang. This means that there may be some actual difference in the distribution of themes between the different studies. Differences could result from differing prompts and emphasis by the interviewers or from many other factors. Additionally, with the exception of family, the other 3 words seem to relate more to the fact that dream narratives include a lot of “I remember…” and “Now that I think of it…”. Their prominence suggests that more thoughtful data cleaning and structuring may be necessary for better theme extraction of the actual narratives.</p>
<p>This is reinforced by moving down a layer or two in the word cloud. Here we do start to see a bigger variety in themes that seem to correspond to actual narratives. Overall, we enjoy how word clouds better present textual data than a histogram or a frequency table.</p>
<hr>
</section>
</section>
</section>
</section>
<section id="section-4-results-analysis-and-discussion" class="level1">
<h1>Section 4: Results, Analysis, and Discussion:</h1>
<p>Throughout this notebook, we have explored the DREAM dataset in good detail. From doing some exploratory visualizations with histograms and word clouds, to doing multi class logistic regression, and statistical test, we’ve covered a lot of ground. In this section we revisit each of our questions and discuss what evidence we found and conclusions it supports, as well as the limitations of the approach and future directions we could go.</p>
<section id="do-dream-stages-correlate-with-dream-experience-recollection-2" class="level2">
<h2 class="anchored" data-anchor-id="do-dream-stages-correlate-with-dream-experience-recollection-2">4.1: Do dream stages correlate with dream experience recollection?</h2>
<section id="goal" class="level3">
<h3 class="anchored" data-anchor-id="goal">Goal:</h3>
<p>Confirm or Reject Claim of Correlation between Last Sleep Stage and Dream Experience</p>
</section>
<section id="models-used" class="level3">
<h3 class="anchored" data-anchor-id="models-used">Models Used:</h3>
<p>We used a Chi Square test for dependence between categorical variables. The null hypothesis is that there is no dependence between Last Sleep Stage and Dream Experience, and the alternative hypothesis is that there is dependence between Last Sleep Stage and Dream Experience.</p>
</section>
<section id="evidence-found" class="level3">
<h3 class="anchored" data-anchor-id="evidence-found">Evidence Found:</h3>
<p>In our test, we found a Chi Square statistic well over 200, when the critical value was only ~17 at the <span class="math inline">\(\alpha = 0.01\)</span> significance level. This correponds to a p value <span class="math inline">\(p &lt; 10^{-44}\)</span> which satisfies our criteria to reject the null hypothesis.</p>
</section>
<section id="conclusion-of-test" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-of-test">Conclusion of Test:</h3>
<p>We reject the null hypothesis.</p>
</section>
<section id="discussion-of-methods-and-results" class="level3">
<h3 class="anchored" data-anchor-id="discussion-of-methods-and-results">Discussion of Methods and Results:</h3>
<p>We attempted to stay true to the paper’s methods of data transform and filtering with what little detail they gave. It gives us some confidence that we get a similar result, but we found a much smaller p value than Wong, et al.&nbsp;with <span class="math inline">\(p = 10^{-15}\)</span>. This could be due to the actual data included, since they do not mention the 1550 row slice of the data used. But, overall this was a straightforward statistical test to run. The visualizations support our confidence, by seeing the actual Chi Square Distribution with 6 degrees of freedom corresponding to our scenario and how early on in the tail the critical value for <span class="math inline">\(\alpha = 0.01\)</span> appears.</p>
<p>This method is limited to just a statement of possible dependence between categorical variables. Our stark p-value give no information on the relationship between Last Sleep Stage and Dream Experience, which we go on to see is not easily modeled by a logistic regression. We also have to assume that our aggregated studies do in fact come from the same distribution, which is likely not true due to the subjective nature of classification.</p>
<p>If repeated in the future, we believe that repeating this analysis on entries after reviewing actual report transcriptions and then classifying experience could help improve confidence. This would ensure that at least the experiences are all categorized with the same methods.</p>
</section>
</section>
<section id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset-2" class="level2">
<h2 class="anchored" data-anchor-id="can-we-predict-dream-experience-recollection-using-more-predictors-in-the-dataset-2">4.2: Can we predict dream experience recollection using more predictors in the dataset?</h2>
<section id="goal-1" class="level3">
<h3 class="anchored" data-anchor-id="goal-1">Goal:</h3>
<p>Attempt to fit a Multi Class Logistic Regression model to predict Experience.</p>
</section>
<section id="models-used-1" class="level3">
<h3 class="anchored" data-anchor-id="models-used-1">Models Used:</h3>
<p>We use same multinomial logistic regression model from the statsmethods api. We attempt to fit with only the Last Sleep Stage, then with Last Sleep Stage, Subject Sex, Subject Age, and Subject Health. We then repeat the two fits with replicated row entries to balance the class numbers in the Response (Experience).</p>
</section>
<section id="evidence-found-1" class="level3">
<h3 class="anchored" data-anchor-id="evidence-found-1">Evidence Found:</h3>
<p>In our first 2 attempts, we only train a trivial classifier that picks the most numerous class (2 - Experience with Recall). In the next 2 attempts, we achieve validation accuracy of 0.43. We find that Last Sleep Stage is consistently significant at the <span class="math inline">\(\alpha = 0.01\)</span> level with positive coeefficients. We also find that Subject sex and age have positive coefficients, while health has a negative one.</p>
</section>
<section id="conclusion-of-model-fits" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-of-model-fits">Conclusion of Model Fits:</h3>
<p>We are able to fit a model that does a bit better than random on the validation sets when class proportions are balanced. However, we do not find good evidence to suggest we have a model that explains the variation in the training and validation data.</p>
</section>
<section id="discussion-of-methods-and-results-1" class="level3">
<h3 class="anchored" data-anchor-id="discussion-of-methods-and-results-1">Discussion of Methods and Results:</h3>
<p>Our selection of a classification based model makes sense, since dream experience is a categorical variable. We started with a basic model with one predictor, to continue the investigation of question 1. It was apparent that some data manipulation was needed to avoid trivial classifiers, as seen with the first 2 models. Having classes 1 and 0 be multiples smaller than class 2 made it hard for a basic model to learn how to differentiate past guessing the most common class.</p>
<p>From the data and evidence, we do conclude that sleep stage can be used to help predict the experience. In our last 2 models, the p-value associated with the coefficients are well below the <span class="math inline">\(\alpha = 0.01\)</span> significance level. So we conclude that we are finding some relationship. However, with a validation accuracy of only 0.43 and a pseudo-r-squared value of 0.035, our model assumptions are certainly missing something.</p>
<p>Our modeling assumptions include those mentioned on 4.1 for the data itself. Additionally, our logistic models assume a basic linear model for the coefficients and log odds of predicition. From how we structured the sleep stage data ranging from 0 - 5, we inherently imposed a numerical ordering on that column. This is not totally incorrect, because the higher the sleep stage, the longer duration of sleep in general. However, this ignores the fact that sleep cycles can repeat throughout the night with average adult experience 4-6 cycles in a night. This changes our interpretation of the model to say that where you are in a per cycle basis is what affects Dream Experience Recall. Again, this does not make our model invalid, but changes the interpretation so we might be missing something important leading to our poor accuracy.</p>
<p>In the future, we would want to collect / extract more detailed sleep stage information, inlcuding total sleep duration, number of full sleep cycles recorded, … etc. Some of this lives in the M/EEG data included, but all studies only monitor a fraction of the time before awakening, not the whole night. In addition, we would try other models like Discriminant analysis and Machine Learning methods like Neural Networks. We hypothesize that sleep experience is a complicated, non-linear phenomena so we expect a more flexible model like a neural net would do well. But, this means more data is needed to train on as we only have ~1500 examples currently.</p>
</section>
</section>
<section id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study-2" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-qualitative-distribution-of-themes-and-sentiments-in-this-dream-study-2">4.3: What is the qualitative distribution of themes and sentiments in this dream study?</h2>
<section id="goal-2" class="level3">
<h3 class="anchored" data-anchor-id="goal-2">Goal:</h3>
<p>Look at the distribution of the extracted themes and sentiments in the dream text dataset in interesting ways.</p>
</section>
<section id="models-used-2" class="level3">
<h3 class="anchored" data-anchor-id="models-used-2">Models Used:</h3>
<p>We use two visualization tools, histograms and word clouds. The histograms show the number of occurences of words in the three theme positions 1,2,3 outputted from ChatGPT, as well as the total aggregation. We use a wordcloud, that prints words with sizes proportional to their relative frequencies. We made word clouds of the total data without NAs and with slices by study group.</p>
<p>For Extracted sentimenets we stuck with histograms of the aggregation, as they seemed less interesting.</p>
</section>
<section id="evidence-found-2" class="level3">
<h3 class="anchored" data-anchor-id="evidence-found-2">Evidence Found:</h3>
<p>For Themes, we found that the top 4 themes in the aggreagted data are Family, Friendship, Memory, Reflection. These are seen across both the histograms and word clouds. We do see that when grouping by study, the main themes remain similar, but Zhang’s top 4 are Reflection, Friendship, Food, and family, while the LODE and Oudiette studies have Reflection, Memory, Sleep, and relationship. We also see that we have 903 unique theme words before cleaning.</p>
<p>For Sentiments, we find that the top 4 words in the aggregated data are: Neutral, Calm, Reflective, and Positive with 409 unique words before cleaning.</p>
</section>
<section id="conclusion-of-model-fits-1" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-of-model-fits-1">Conclusion of Model Fits:</h3>
<p>From these visualizations, we can see that we do get some theme and sentiment information that could be useful from ChatGPT. We see that the distribution of themes appear different between the Zhang study and the other 2 by eye.</p>
</section>
<section id="discussion-of-methods-and-results-2" class="level3">
<h3 class="anchored" data-anchor-id="discussion-of-methods-and-results-2">Discussion of Methods and Results</h3>
<p>Visualization with histograms are more boring but are easier to interpret since we have access to bar heights. From the evidence above, we see that a few words show up often in both theme and sentiment extraction. However, when thinking about the meaning, reflective and memory for themes and neutral and reflective for sentimenets being at the top may point to inadequacy of our prompt and data cleaning for the LLM. We chose to simply input the raw text of the narration with a basic prompt, which left artifacts of the study in the narrative, likely influencing the output extractions. Some more thought into transforming the dream texts into better narrative structures could help clean this up.</p>
<p>The word clouds are an interesting tool that makes “eye balling” textual data more appealing and useful. From the plots above, we see some major differences in which words are most amplified between the 3 studies. This could be due to how the different studies structured their responses collection / prompts for participants. It also points to the need to better normalize reponse collection and transformation during this process. We think that some of the differences could be weeded out by better structuring of the prompts.</p>
<p>Its important to emphasize that these inital explorations are limited to qualitative and high level questions and conclusions. Visualization tools are extremely important in understanding how the data is distributed and looks, but cannot replace more rigorous numerical tests if we want to drill down and make specific statements on the data. Additionally, our use of histograms and word clouds highlights the tradeoffs we make when choosing different tools. Word clouds are visually more expressive and interesting, but the interpretability goes down significantly, since we have no real measure or check of relative word frequencies. Likewise, histograms are visually less interesting and more filtering had to be done to make the final plots readable. But, we keep frequency information so some conclusions can be drawn directly.</p>
<p>For future work, we would want to drill down on these distributions in a more methodical way. Finding a good word encoding may offer more insight and potential tests to run, but we lack the knowledge / skill set in NLP to know what tools exist. Also, more emphasis in prompt engineering and text structure would be needed to better improve the interpretability of our extractions. ***</p>
</section>
</section>
</section>
<section id="section-5-impact-and-final-thoughts" class="level1">
<h1>Section 5: Impact and Final Thoughts</h1>
<section id="impact-of-this-work" class="level2">
<h2 class="anchored" data-anchor-id="impact-of-this-work">Impact of this Work:</h2>
<p>At a high level this study is an exploratory analysis of dream data in a scientfic and statistical way. This has not been done in too much detail and rigor outside of niche areas within the neuroscience and psychology research communites. Therefore, it marks an interest to expand on their works and expand our understandings of dreams and their relation to our brains, sleep, and their predicitability. Consequently, we believe that if there was widespread interest in the subject and research area, there would be socio-economic power, ethical, and philosophical implications.</p>
<p>One major consideration is that dreams are arguably one of the last realms of non-commercialized human experience, so do we want to encourage a scientific characterization? A natural extension of this project would be to extend predictions to dream themes and sentiment based on subject characteristics and experiences. We can imagine that with this line of research, business advertising would be an interested party in funding research if links could be made to dream themes and recollection. It is a bit dystopian and alarmist, but we could imagine what lines of “dream products” could be funded if they showed better dream retention for better advertising results. Additionally, political groups could use such tools to spread propoganda and behavioral ideals through another medium of experience.</p>
<p>But before these imaginary futures, we need to look into the ethical and moral concerns. What is the cost to benefit of understanding such a fundamental and mystical part of sleep? Thinking of power structures, an understanding of dreams could shift power of understanding to individual dreamer which may be a plus to human experience. But, as often is the case with behavioral understanding, it pushes more power to parties with interests and means in exploiting it for gain which would include governments and businesses. This would call for regulation and other parts of normal experience being applied to dreams of all people, which to our sense seems like an overstep in such a personal experience. Therefore, we find that this branch of research quickly evolves into complex ethical and moral conversations that had nothing to do with our original goals.</p>
<p>The work we show here is a basic example of what the investigation of simple questions can look like and are relatively innocent questions, coming from a place of curiosity. However, when thinking of the long term gains, there is not much benefit to human experience. If our assumptions that dreams can be characterized in this way is true, then we open ourselves up to unforseen effects of exploitation for commercial and perhaps political gains. On the other hand, if this assumption is false, then our work here is in vain. Therefore, we think that the potential benefits of pursuing the subject further are not worth the cost.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>